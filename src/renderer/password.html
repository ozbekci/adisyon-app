<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Yönetici Şifresi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      user-select: none;
      -webkit-user-select: none;
    }
  </style>
</head>
<body class="bg-gray-100">
  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl w-96 p-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold text-gray-900">Yönetici Şifresi</h2>
        <button onclick="closeWindow()" class="p-1 hover:bg-gray-100 rounded-full transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <div class="mb-6">
        <!-- Şifre Gösterimi -->
        <div class="bg-gray-100 p-4 rounded-lg mb-4">
          <div class="flex justify-center items-center h-12 bg-white rounded-md border border-gray-300">
            <div id="password-display" class="text-2xl tracking-widest font-mono"></div>
          </div>
        </div>

        <!-- Numerik Tuş Takımı -->
        <div class="grid grid-cols-3 gap-3" id="numpad"></div>
      </div>

      <div id="error-message" class="text-red-600 text-sm text-center mb-4 bg-red-50 p-2 rounded-lg hidden"></div>

      <div class="flex space-x-3">
        <button onclick="closeWindow()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
          İptal
        </button>
        <button onclick="verifyPassword()" id="verify-button" disabled class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          Doğrula
        </button>
      </div>
    </div>
  </div>

  <script>
    let password = '';
    const maxLength = 6;
    const passwordDisplay = document.getElementById('password-display');
    const verifyButton = document.getElementById('verify-button');
    const errorMessage = document.getElementById('error-message');

    // Numerik tuş takımı oluştur
    const numpad = document.getElementById('numpad');
    const layout = [
      [1, 2, 3],
      [4, 5, 6],
      [7, 8, 9],
      ['clear', 0, 'backspace']
    ];

    layout.forEach(row => {
      row.forEach(key => {
        const button = document.createElement('button');
        button.className = 'p-4 text-2xl font-semibold text-gray-700 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors active:bg-gray-200';
        
        if (key === 'clear') {
          button.textContent = 'Temizle';
          button.className = 'p-4 text-sm font-medium text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors';
          button.onclick = clearPassword;
        } else if (key === 'backspace') {
          button.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mx-auto text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 12l6.414-6.414a2 2 0 0 1 2.828 0L19 12" />
            </svg>
          `;
          button.className = 'p-4 flex items-center justify-center bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors';
          button.onclick = backspace;
        } else {
          button.textContent = key;
          button.onclick = () => addNumber(key);
        }
        
        numpad.appendChild(button);
      });
    });

    function updateDisplay() {
      passwordDisplay.textContent = password ? '*'.repeat(password.length) : 'PIN Giriniz';
      verifyButton.disabled = !password;
      errorMessage.classList.add('hidden');
    }

    function addNumber(num) {
      if (password.length < maxLength) {
        password += num;
        updateDisplay();
      }
    }

    function backspace() {
      password = password.slice(0, -1);
      updateDisplay();
    }

    function clearPassword() {
      password = '';
      updateDisplay();
    }

    async function verifyPassword() {
      try {
        const result = await window.electronAPI.verifyAdminPassword(password);
        if (!result) {
          errorMessage.textContent = 'Yanlış şifre!';
          errorMessage.classList.remove('hidden');
          clearPassword();
        }
      } catch (error) {
        errorMessage.textContent = 'Bir hata oluştu. Tekrar deneyin.';
        errorMessage.classList.remove('hidden');
        clearPassword();
      }
    }

    function closeWindow() {
      window.electronAPI.closePasswordWindow();
    }
  </script>
</body>
</html> 